---

- name: Test with defaults
  hosts: localhost
  vars:
    miniconda_prefix: "{{ lookup('env', 'TRAVIS_BUILD_DIR') | default('/tmp', true) }}/conda"
  tasks:
    - name: Run ansible-miniconda role with defaults
      ansible.builtin.include_role:
        name: ansible-miniconda

    - name: Cleanup conda prefix directory
      ansible.builtin.file:
        path: "{{ miniconda_prefix }}"
        state: absent

- name: Test with miniforge
  hosts: localhost
  vars:
    miniconda_prefix: "{{ lookup('env', 'TRAVIS_BUILD_DIR') | default('/tmp', true) }}/conda"
  tasks:
    - name: Run ansible-miniconda role with miniforge
      ansible.builtin.include_role:
        name: ansible-miniconda
      vars:
        miniconda_distribution: "miniforge"
        miniconda_conda_environments:
          test_env:
            channels:
              - conda-forge
            packages:
              - zlib

    - name: Cleanup conda prefix directory
      ansible.builtin.file:
        path: "{{ miniconda_prefix }}"
        state: absent

- name: Test with miniconda
  hosts: localhost
  vars:
    miniconda_prefix: "{{ lookup('env', 'TRAVIS_BUILD_DIR') | default('/tmp', true) }}/conda"
  tasks:
    - name: Run ansible-miniconda role with miniconda
      ansible.builtin.include_role:
        name: ansible-miniconda
      vars:
        miniconda_distribution: "miniconda"
        miniconda_conda_environments:
          test_env:
            channels:
              - conda-forge
            packages:
              - zlib

    - name: Cleanup conda prefix directory
      ansible.builtin.file:
        path: "{{ miniconda_prefix }}"
        state: absent

- name: Test with anaconda
  hosts: localhost
  vars:
    miniconda_prefix: "{{ lookup('env', 'TRAVIS_BUILD_DIR') | default('/tmp', true) }}/conda"
  tasks:
    - name: Run ansible-miniconda role with anaconda
      ansible.builtin.include_role:
        name: ansible-miniconda
      vars:
        miniconda_distribution: "anaconda"
        miniconda_installer_version: "2025.06-0"
        miniconda_conda_environments:
          test_env:
            channels:
              - conda-forge
            packages:
              - zlib

    - name: Cleanup conda prefix directory
      ansible.builtin.file:
        path: "{{ miniconda_prefix }}"
        state: absent

- name: Test with micromamba
  hosts: localhost
  vars:
    miniconda_prefix: "{{ lookup('env', 'TRAVIS_BUILD_DIR') | default('/tmp', true) }}/conda"
  tasks:
    - name: Run ansible-miniconda role with micromamba
      ansible.builtin.include_role:
        name: ansible-miniconda
      vars:
        miniconda_distribution: "micromamba"
        miniconda_conda_environments:
          test_env:
            channels:
              - conda-forge
            packages:
              - zlib

    - name: Cleanup conda prefix directory
      ansible.builtin.file:
        path: "{{ miniconda_prefix }}"
        state: absent
